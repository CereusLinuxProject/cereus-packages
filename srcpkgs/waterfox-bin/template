# Template file for 'waterfox-bin'
pkgname=waterfox-bin
version=G6.0.20
revision=1
archs="x86_64"
repository="cereus-extra"
build_style=fetch
hostmakedepends="bsdtar"
depends="dbus-glib ffmpeg gtk+ gtk+3 hicolor-icon-theme startup-notification libnotify fontconfig libXt"
short_desc="Sixth generation of customizable privacy-conscious web browser (precompiled binaries)"
maintainer="Kevin Figueroa <kfdevart@disroot.org>"
license="MPL-2.0"
homepage="https://www.waterfox.net"
changelog="${homepage}/docs/releases/${version}/"
distfiles="https://cdn1.waterfox.net/waterfox/releases/${version}/Linux_x86_64/waterfox-${version}.tar.bz2"
checksum=7035d9cd1ecdd13c7728a9f918638afd5e322422b53e3c3b4b89e26b6361e342
replaces="waterfox-g4-bin waterfox-g5-bin"

do_install() {
    vmkdir opt
    bsdtar -C ${DESTDIR}/opt/ -xf waterfox-${version}.tar.bz2
    vmkdir usr/bin
    ln -rfs ${DESTDIR}/opt/waterfox/waterfox ${DESTDIR}/usr/bin/

    # Copy launcher
    vmkdir usr/share/applications
        vcopy ${FILESDIR}/waterfox.desktop  usr/share/applications

    # Install the icons
    for res in 16 32 48 64 128; do
                vmkdir usr/share/icons/hicolor/${res}x${res}/apps
                vcopy ${DESTDIR}/opt/waterfox/browser/chrome/icons/default/default${res}.png \
                        usr/share/icons/hicolor/${res}x${res}/apps/waterfox.png
    done

   # Add additional useful settings
   install -Dm644 /dev/stdin "${DESTDIR}/opt/waterfox/browser/defaults/preferences/vendor.js" <<END

// Use LANG environment variable to choose locale
pref("intl.locale.requested", "");

// Automatic installation of updates won't work on root, so disable this
pref("app.update.auto", false);

// Use system-provided dictionaries
pref("spellchecker.dictionary_path", "/usr/share/hunspell");
END

# Disable automatic updates and update notifications
    install -Dm644 /dev/stdin "${DESTDIR}/opt/waterfox/distribution/policies.json" <<END
{
    "policies": {
        "AppAutoUpdate": false,
        "ManualAppUpdateOnly": false
    }
}
END
}

waterfox-g6-bin_package() {
	build_style=meta
	depends="waterfox-bin>=${version}"
	reverts="6.0.19_1 6.0.18_1 6.0.17_1 6.0.16_1 6.0.15_1"
	short_desc+=" - transitional dummy package"
}
