# Template file for 'palemoon'
pkgname=palemoon
version=29.4.6
revision=1
_release=1
archs="i686 x86_64"
hostmakedepends="curl python3-html2text tar xz"
depends="libvpx alsa-lib dbus-glib libXt gtk+ "
short_desc="An optimized Web Browser forked from Firefox Browser"
maintainer="David C. <https://github.com/David-Castro16>"
license="Mozilla Public License v2.0"
homepage="https://www.palemoon.org"
checksum=

if [ "$XBPS_TARGET_MACHINE" = "x86_64" ]; then
    _debarch=amd64
    checksum=
else
    _debarch=i386
    checksum=
fi

distfiles="https://download.opensuse.org/repositories/home:/stevenpusser/Debian_10/${_debarch}/${pkgname}_${version}-${_release}.gtk2_${_debarch}.deb"
_licenseURL="https://www.palemoon.org/redist.shtml"

do_extract() {
  ar x ${XBPS_SRCDISDIR}/${pkgname}-${version}/${pkgname}_${version}-${_release}.gtk2_${_debarch}.deb
  tar xf data.tar.xz
}

do_install() {
   vinstall usr/share/applications/${pkgname}.desktop 0644 \ 
           usr/share/applications
   vmkdir opt
   vmkdir usr/bin

   vcopy /usr/lib/palemoon opt
   ln -s /opt/palemoon/palemoon "${DESTDIR}/usr/bin/palemoon"

   for res in 16 32 48 128; do
     vinstall usr/share/icons/hicolor/${res}x${res}/apps/${pkgname}.png 0644 \ usr/share/icons/hicolor/${res}x${res}/apps ${pkgname}.png 
   done
}

post_install(){
     curl ${_licenseURL} | html2text | sed '1,57d' > EULA.md 
     vlicense EULA.md
}
